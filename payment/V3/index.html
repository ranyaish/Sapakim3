<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>אפליקציית חישוב משכורות</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;600;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./styles.css" />

  <!-- SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>
  <!-- App -->
  <script src="./app.js" defer></script>
</head>
<body>
<header><h1>אפליקציית חישוב משכורות</h1></header>

<div class="wrap">
  <div class="card pad">
    <div class="row">
      <div class="col">
        <label>קובץ Excel/CSV במבנה הקבוע</label><br>
        <input id="file" type="file" accept=".xlsx,.xls,.csv" class="inp" />
      </div>
      <div class="col">
        <label>בחירת עובד</label><br>
        <select id="employeeFilter" class="inp" disabled></select>
      </div>
      <div class="col btns">
        <button id="openCardBtn" class="btn alt" disabled>פתח כרטיס עובד</button>
        <button id="exportDaily" class="btn" disabled>ייצוא פירוט יומי (CSV)</button>
        <button id="exportSummary" class="btn" disabled>ייצוא סיכום חודשי (CSV)</button>
      </div>
      <div class="col btns">
        <button id="exportJSON" class="btn alt" disabled>ייצוא JSON (סשן)</button>
        <input id="importJSONFile" type="file" accept=".json,application/json" class="inp" style="display:none" />
        <button id="importJSON" class="btn alt">טעינת JSON</button>
        <button id="clearSession" class="btn warn">ניקוי סשן</button>
      </div>
    </div>
    <div class="foot">
      שבת <b>08:00–17:00</b> = 150% (אם משמרת מתחילה בשבת <b>מ-16:00 ומעלה</b> – שעות שבת לא נספרות).
      נוספות יומיות: מצב A (9/11 → 100%/125%/150%) או מצב B (ללא נוספות).
    </div>
  </div>
</div>

<!-- Modal: כרטיס עובד -->
<div id="empModal" class="modal" aria-hidden="true">
  <div class="backdrop" onclick="closeEmpModal()"></div>
  <div class="dialog">
    <header>
      <h2 id="empModalTitle">כרטיס עובד</h2>
      <button class="btn warn" onclick="closeEmpModal()">סגור</button>
    </header>
    <div class="content">
      <div class="tabs">
        <button id="tab-config" class="tab active">פרטי שכר</button>
        <button id="tab-daily" class="tab">פירוט יומי (משוקלל) + סעיפים</button>
        <button id="tab-punches" class="tab">משמרות (כניסה/יציאה)</button>
      </div>
      <div class="grid2">
        <div>
          <!-- CONFIG TAB -->
          <div id="panel-config">
            <div class="sumbox">
              <div class="sumrow">
                <label>מצב חישוב</label>
                <select id="empMode" class="inp narrow">
                  <option value="A">מצב A – נוספות יומיות (9/11)</option>
                  <option value="B">מצב B – ללא נוספות יומיות</option>
                </select>
              </div>
              <div class="sumrow">
                <label>שכר לשעה (₪)</label>
                <input id="empRate" type="number" step="0.01" class="inp narrow" />
              </div>
            </div>
            <div class="hr"></div>
            <div class="pill" style="margin:6px 0">תצוגת חודש</div>
            <div class="sumrow">
              <label>חודש (YYYY-MM)</label>
              <select id="empMonthSel" class="inp narrow"></select>
            </div>
          </div>

          <!-- DAILY TAB -->
          <div id="panel-daily" style="display:none">
            <div class="pill" style="margin-bottom:8px">סעיפים לחודש הנבחר</div>
            <div class="sumbox" style="margin-bottom:10px">
              <div class="sumrow"><label>נסיעות (₪)</label><input id="extra_travel" type="number" step="0.01" class="inp narrow" /></div>
              <div class="sumrow"><label>טיפים (₪)</label><input id="extra_tips" type="number" step="0.01" class="inp narrow" /></div>
              <div class="sumrow"><label>תוספת (₪)</label><input id="extra_bonus" type="number" step="0.01" class="inp narrow" /></div>
              <div class="sumrow"><label>החזר מקדמה (₪-)</label><input id="extra_advance" type="number" step="0.01" class="inp narrow" /></div>
              <button id="saveExtrasBtn" class="btn" style="margin-top:8px">שמירה</button>
            </div>

            <div class="pill" style="margin-bottom:8px">פירוט יומי משוקלל לחודש שנבחר</div>
            <div class="tablewrap">
              <table id="empCardDaily">
                <thead>
                  <tr>
                    <th>תאריך</th>
                    <th>סה"כ</th>
                    <th>100%</th>
                    <th>125%</th>
                    <th>150%</th>
                    <th>שבת 150%</th>
                    <th>משוקלל</th>
                    <th>שכר יום</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <!-- PUNCHES TAB -->
          <div id="panel-punches" style="display:none">
            <div class="pill" style="margin-bottom:8px">משמרות (כניסה/יציאה) לחודש שנבחר</div>
            <div class="tablewrap">
              <table id="empPunches">
                <thead>
                  <tr>
                    <th>תאריך</th>
                    <th>יום</th>
                    <th>שעת כניסה</th>
                    <th>שעת יציאה</th>
                    <th>משך (שעות)</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <div>
          <div class="sumbox">
            <div class="pill">סיכום חודש נבחר</div>
            <div class="hr"></div>
            <div class="sumrow"><span>שעות משוקללות</span><b id="empWgt">0</b></div>
            <div class="sumrow"><span>שכר בסיס</span><b id="empBase">0</b></div>
            <div class="sumrow"><span>סעיפים</span><b id="empExtrasSum">0</b></div>
            <div class="hr"></div>
            <div class="sumrow"><span>שכר סופי (כולל סעיפים)</span><b id="empFinal">0</b></div>
          </div>
        </div>
      </div>
      <div class="foot small">
        הסעיפים נשמרים לפי חודש לכל עובד. הכל מתעדכן מיידית בשמירה.
      </div>
    </div>
  </div>
</div>
</body>
</html>
