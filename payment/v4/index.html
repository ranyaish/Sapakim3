<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>אפליקציית חישוב משכורות – v1.9.9</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;600;800&display=swap" rel="stylesheet">
<!-- Favicon רגיל -->
<link rel="icon" type="image/png" href="icon-193.png">

<!-- אייקון למסך הבית ב-iOS -->
<link rel="apple-touch-icon" href="icon-193.png">

<!-- צבע מסגרת למכשירים אנדרואיד/כרום -->
<meta name="theme-color" content="#0b1b2b">

<!-- מניפסט PWA (לא חובה ל-iOS, כן מומלץ לאנדרואיד) -->
<link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="styles.css?v=1.9.9" />

  <!-- SheetJS (XLSX/CSV) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <!-- XlsxPopulate for XLSX export -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx-populate/browser/xlsx-populate.min.js"></script>
</head>
<body>
<header>
  <h1>אפליקציית חישוב משכורות</h1>
</header>

<div class="wrap">

  <!-- כרטיס קלט -->
  <div class="card pad">
    <div class="row">
      <div class="col">
        <label>טעינת קובץ Excel/CSV</label>
        <input id="file" type="file" accept=".xlsx,.xls,.csv" class="inp" />
      </div>
      <div class="col">
        <label>בחירת עובד לתצוגה</label>
        <select id="employeeFilter" class="inp" disabled>
          <option value="ALL">כל העובדים</option>
        </select>
      </div>
      <div class="col btns">
        <button id="openCardBtn" class="btn" disabled>כרטיס עובד</button>
        <button id="exportDaily" class="btn alt" disabled>ייצוא פירוט יומי (XLSX)</button>
        <button id="exportSummary" class="btn alt" disabled>ייצוא סיכום (XLSX)</button>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <div class="col btns">
        <button id="exportJSON" class="btn">שמירת נתוני סשן (JSON)</button>
        <button id="importJSON" class="btn">טעינת JSON</button>
        <input id="importJSONFile" type="file" accept=".json" style="display:none" />
        <button id="clearSession" class="btn warn">ניקוי זיכרון מקומי</button>
      </div>
    </div>

    <div class="foot small">
      חוקי חישוב: שבת <b>08:00–17:00</b> = 150% (אם משמרת מתחילה בשבת <b>מ-16:00 ומעלה</b> – לא נספרות שעות שבת).<br/>
      נוספות יומיות: מצב A (9/11 → 100%/125%/150%) או מצב B (ללא נוספות).
    </div>
  </div>

  <!-- סיכום חודשי -->
  <div class="card pad" style="margin-top:14px">
    <div class="toolbar">
      <span class="pill">סיכום חודשי</span>
      <span class="muted">לפי הנתונים שהועלו</span>
    </div>
    <div class="tablewrap hscroll" style="margin-top:10px">
      <table id="summaryTable">
        <thead>
          <tr>
            <th>עובד</th>
            <th>סה"כ שעות</th>
            <th>רגיל 100%</th>
            <th>נוספות 125%</th>
            <th>נוספות 150%</th>
            <th>שבת 150%</th>
            <th>שעות משוקללות</th>
            <th>שכר בסיס</th>
            <th>נסיעות</th>
            <th>טיפים</th>
            <th>תוספת שכר</th>
            <th>החזר מקדמה</th>
            <th>שכר ברוטו</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr id="summaryTotalsRow">
            <th>סה״כ</th>
            <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
            <td>0</td><td>0</td>
            <td>0</td><td>0</td><td>0</td><td>0</td>
            <td>0</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>

<!-- מודאל: כרטיס עובד -->
<div id="empModal" class="modal" aria-hidden="true">
  <div class="dialog">
    <header>
      <div class="meta" style="display:flex;align-items:center;gap:6px">
        <!-- שים לב: הבא לפני קודם (כמו שביקשת) -->
        <button id="empNext" class="btn small" type="button">הבא ▶︎</button>
        <button id="empPrev" class="btn small" type="button">◀︎ קודם</button>
        <h2 id="empModalTitle" style="margin:0 8px">כרטיס עובד</h2>
        <select id="empMonthSel" class="inp" style="width:auto;min-width:140px"></select>
      </div>
      <div class="meta">
        <button id="empClose" class="btn small" type="button">סגור</button>
      </div>
    </header>

    <div class="content">
      <div class="tabs">
        <button id="tab-config"  class="tab active" type="button">פרטי שכר</button>
        <button id="tab-daily"   class="tab" type="button">פירוט יומי</button>
        <button id="tab-punches" class="tab" type="button">משמרות</button>
      </div>

      <!-- פרטי שכר -->
      <section id="panel-config">
        <div class="grid2">
          <div>
            <div class="row">
              <div class="col" style="max-width:240px">
                <label>מצב חישוב</label>
                <select id="empMode" class="inp">
                  <option value="A">מצב A – נוספות יומיות (9/11)</option>
                  <option value="B">מצב B – ללא נוספות</option>
                </select>
              </div>
              <div class="col" style="max-width:240px">
                <label>שכר לשעה (₪)</label>
                <input id="empRate" type="number" min="0" step="0.01" class="inp" />
              </div>
            </div>
            <div class="hr"></div>
            <div class="small muted">הערה: סעיפים חודשיים (נסיעות/טיפים/תוספת/מקדמה) נמצאים בטאב “פירוט יומי”.</div>
          </div>

          <aside class="sumbox">
            <div class="sumrow"><span>שעות משוקללות בחודש</span><b id="empWgt">0</b></div>
            <div class="sumrow"><span>שכר בסיס</span><b id="empBase">0</b></div>
            <div class="sumrow"><span>סה״כ סעיפים</span><b id="empExtrasSum">0</b></div>
            <div class="hr"></div>
            <div class="sumrow"><span>שכר ברוטו</span><b id="empFinal">0</b></div>
          </aside>
        </div>
      </section>

      <!-- פירוט יומי + סעיפים -->
      <section id="panel-daily" style="display:none">
        <div class="row">
          <div class="col" style="max-width:780px">
            <div class="tablewrap hscroll scroll-y">
              <table id="empCardDaily">
                <thead>
                  <tr>
                    <th>תאריך</th>
                    <th>סה"כ שעות</th>
                    <th>רגיל 100%</th>
                    <th>נוספות 125%</th>
                    <th>נוספות 150%</th>
                    <th>שבת 150%</th>
                    <th>שעות משוקללות</th>
                    <th>שכר יום</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <aside class="sumbox" style="min-width:260px">
            <div class="sumrow"><span>נסיעות</span><input id="extra_travel" type="number" step="0.01" class="inp narrow" /></div>
            <div class="sumrow"><span>טיפים</span><input id="extra_tips" type="number" step="0.01" class="inp narrow" /></div>
            <div class="sumrow"><span>תוספת שכר</span><input id="extra_bonus" type="number" step="0.01" class="inp narrow" /></div>
            <div class="sumrow"><span>החזר מקדמה</span><input id="extra_advance" type="number" step="0.01" class="inp narrow" /></div>
            <div class="hr"></div>
            <button id="saveExtrasBtn" class="btn" type="button">שמירה</button>
          </aside>
        </div>
      </section>

      <!-- משמרות (Clock-ins) -->
      <section id="panel-punches" style="display:none">
        <div class="tablewrap hscroll scroll-y">
          <table id="empPunches">
            <thead>
              <tr>
                <th>תאריך</th>
                <th>יום</th>
                <th>כניסה</th>
                <th>יציאה</th>
                <th>סה"כ</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

    </div>
  </div>
</div>

<script src="app.js?v=1.9.9"></script>
</body>
</html>
