<!doctype html>
<html lang="he" dir="rtl">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DEBUG — Supabase Login Button</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<body style="font-family:system-ui;max-width:680px;margin:28px auto;padding:16px">
  <h1>DEBUG — בדיקת כפתור כניסה</h1>
  <p>עמוד זה מציג כל שלב בלוג. אם הכפתור לא מגיב, יופיע הסבר כאן.</p>

  <div id="env" style="padding:8px;border:1px solid #ddd;border-radius:8px;background:#fafafa;margin-bottom:12px"></div>

  <label>אימייל</label>
  <input id="email" style="width:100%;padding:8px"><br><br>
  <label>סיסמה</label>
  <input id="password" type="password" style="width:100%;padding:8px"><br><br>

  <button id="loginBtn" style="padding:10px 14px">כניסה</button>
  <button id="sessionBtn" style="padding:10px 14px">בדוק סשן</button>
  <button id="logoutBtn" style="padding:10px 14px">יציאה</button>

  <pre id="log" style="margin-top:16px;background:#111;color:#0f0;padding:12px;border-radius:8px;white-space:pre-wrap;min-height:160px"></pre>

<script>
(function(){
  const env = document.getElementById('env');
  const logEl = document.getElementById('log');
  function log(msg){
    logEl.textContent += (typeof msg === 'string' ? msg : JSON.stringify(msg,null,2)) + "\n";
  }
  function setEnv(ok, details){
    env.innerHTML = ok ? 
      '<b style="color:green">OK:</b> ספריית Supabase נטענה. URL ו-Key מוכנים.' :
      '<b style="color:red">ERROR:</b> window.supabase לא מוגדר — הספרייה לא נטענה.';
    if(details) env.innerHTML += '<div style="margin-top:6px;font-size:12px;color:#555">' + details + '</div>';
  }

  // 1) בדוק שהספרייה קיימת
  if(!window.supabase){ setEnv(false, 'בדוק חיבור ל-jsDelivr / חסימת תוספים בדפדפן.'); return; }
  setEnv(true, 'יובא מ: https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2');

  // 2) צור לקוח עם try/catch
  let supabaseClient = null;
  try {
    supabaseClient = window.supabase.createClient("https://uzaqpwbejceyuhnmfdmq.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6YXFwd2JlamNleXVobm1mZG1xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyODc3NzMsImV4cCI6MjA3MDg2Mzc3M30.Wcuu97xzFvJCt8x2ubHLwc19-ZsfrRLK9YZHICV3T3A", { auth: { persistSession:true, autoRefreshToken:true, detectSessionInUrl:true } });
    log('createClient: OK');
  } catch(e) {
    log('createClient ERROR: ' + (e && e.message ? e.message : e));
    return;
  }

  // 3) חבר מאזינים לכפתורים בבירור
  const loginBtn = document.getElementById('loginBtn');
  const sessionBtn = document.getElementById('sessionBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const emailEl = document.getElementById('email');
  const passEl  = document.getElementById('password');

  if(!loginBtn) { log('ERROR: loginBtn element missing'); return; }

  loginBtn.addEventListener('click', async function(){
    log('CLICK: loginBtn');
    try {
      const email = (emailEl.value||'').trim();
      const password = passEl.value||'';
      log('signInWithPassword…');
      const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });
      if(error) log('Login ERROR: ' + error.message);
      else log(['Login OK', data]);
    } catch(e) { log('Login JS ERROR: ' + (e && e.message ? e.message : e)); }
  });

  sessionBtn.addEventListener('click', async function(){
    const s = await supabaseClient.auth.getSession();
    log(['SESSION', s]);
  });

  logoutBtn.addEventListener('click', async function(){
    const r = await supabaseClient.auth.signOut();
    log(['LOGOUT', r]);
  });

  // 4) דיווח התחלתי
  supabaseClient.auth.getSession().then(s=>log(['Initial session', s]));
})();
</script>
</body>
</html>
